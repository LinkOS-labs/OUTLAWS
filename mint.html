<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Mint OUTLAWS ‚Äî Monad</title>
  <link rel="stylesheet" href="style.css">
  <script src="https://cdn.jsdelivr.net/npm/ethers@6.12.0/dist/ethers.umd.min.js"></script>
</head>
<body>
<div class="page-wrapper">

  <header class="navbar">
    <div class="nav-left">
      <div class="logo-badge"></div>
      <div>
        <div class="nav-title"><span>OUTLAWS</span> / MONAD</div>
        <div class="nav-sub">Public Mint</div>
      </div>
    </div>
    <nav class="nav-links">
      <a href="index.html">Home</a>
      <a href="about.html">Lore</a>
      <a href="roadmap.html">Roadmap</a>
      <a href="gallery.html">Gallery</a>
      <a href="mint.html">Mint</a>
    </nav>
  </header>

  <main>
    <section class="section">
      <h2 class="section-title">Mint OUTLAWS</h2>
      <p class="section-sub">
        Connect any EVM wallet on Monad and mint directly from this page.
      </p>

      <div id="supply" class="supply">
        Loading supply‚Ä¶
      </div>

      <div class="mint-card-outer">
        <div class="mint-card">

          <div class="mint-label">Quantity</div>
          <input type="number" id="qty" class="mint-input" min="1" max="20" value="1">

          <div style="margin-top:18px;">
            <button id="connectBtn" class="btn-primary" style="width:100%;margin-bottom:8px;">
              Connect Wallet
            </button>
            <button id="mintBtn" class="btn-outline" style="width:100%;" disabled>
              Mint
            </button>
          </div>

          <div id="status" class="status" style="margin-top:14px;">
            Status: Idle
          </div>
        </div>
      </div>

      <div class="info-box">

        <div style="font-size:13px; text-transform:uppercase; letter-spacing:0.16em; margin-bottom:6px;">
          Official OUTLAWS Links
        </div>

        <p>
          üî• Announcement on X:<br>
          <a href="https://x.com/APUNKALYPSENOW" target="_blank">
            https://x.com/APUNKALYPSENOW
          </a>
        </p>

        <p>
          üåê View on OpenSea:<br>
          <a href="https://opensea.io/assets/monad/0x82712eabe817390Ad792699f1f5d4A62c3479968"
             target="_blank">
            OpenSea ‚Äî OUTLAWS
          </a>
        </p>

        <p>
          üíé Magic Eden:<br>
          <a href="https://magiceden.io/collections/monad/0x82712eabe817390Ad792699f1f5d4A62c3479968"
             target="_blank">
            Magic Eden ‚Äî OUTLAWS
          </a>
        </p>

        <p style="margin-top:18px;">
          Contract:<br>
          <a href="https://monadscan.com/address/0x82712eabe817390Ad792699f1f5d4A62c3479968"
             target="_blank">0x8271...9968</a>
          <br><br>
          Deployer:<br>
          <a href="https://monadscan.com/address/0x13cb67bb03277ce4326797283821aea7016d8a90"
             target="_blank">0x13cb...8a90</a>
        </p>

      </div>
    </section>
  </main>

  <footer class="footer">
    <div>
      Contract:
      <a href="https://monadscan.com/address/0x82712eabe817390Ad792699f1f5d4A62c3479968"
         target="_blank">0x8271...9968</a>
    </div>
    <div>
      X:
      <a href="https://x.com/APUNKALYPSENOW" target="_blank">@APUNKALYPSENOW</a>
    </div>
  </footer>

</div>

<script>
/* CONFIG */
const CONTRACT_ADDRESS = "0x82712eabe817390Ad792699f1f5d4A62c3479968";
const RPC_URL = "https://rpc.monad.xyz";

// ABI m√≠nimo
const ABI = [
  "function mint(uint256 quantity) external payable",
  "function MINT_PRICE() view returns (uint256)",
  "function totalMinted() view returns (uint256)",
  "function MAX_SUPPLY() view returns (uint256)"
];

function log(msg){ document.getElementById("status").textContent = msg; }

function getAnyProvider(){
  if (window.ethereum && Array.isArray(window.ethereum.providers)) {
    const m = window.ethereum.providers.find(p=>p.isMetaMask);
    if (m) return m;
    const ph = window.ethereum.providers.find(p=>p.isPhantom);
    if (ph) return ph;
    return window.ethereum.providers[0];
  }
  if (window.phantom && window.phantom.ethereum) return window.phantom.ethereum;
  if (window.ethereum) return window.ethereum;
  return null;
}

// LOAD SUPPLY
(async()=>{
  try{
    const rpc = new ethers.JsonRpcProvider(RPC_URL);
    const c = new ethers.Contract(CONTRACT_ADDRESS, ABI, rpc);
    const minted = await c.totalMinted();
    const max = await c.MAX_SUPPLY();
    document.getElementById("supply").textContent = `Minted: ${minted} / ${max}`;
  }catch(e){
    document.getElementById("supply").textContent = "Minted: ? / ?";
  }
})();

let provider, signer, contract;

// CONNECT
document.getElementById("connectBtn").onclick = async()=>{
  try{
    const injected = getAnyProvider();
    if(!injected) return log("No EVM wallet detected.");

    const acc = await injected.request({method:"eth_requestAccounts"});
    provider = new ethers.BrowserProvider(injected);
    signer   = await provider.getSigner();
    contract = new ethers.Contract(CONTRACT_ADDRESS, ABI, signer);

    log(`Connected: ${acc[0]}\nReady to mint.`);
    document.getElementById("mintBtn").disabled = false;

  }catch(err){
    log("Connect error:\n"+(err.message || err));
  }
};

// MINT
document.getElementById("mintBtn").onclick = async()=>{
  try{
    const qty = parseInt(document.getElementById("qty").value);
    if(qty<1) return log("Invalid quantity.");

    const price = await contract.MINT_PRICE();
    const total = price * BigInt(qty);

    log("Sending mint tx‚Ä¶");
    const tx = await contract.mint(qty,{ value: total, gasLimit:300000n*BigInt(qty) });
    log("Waiting confirmation‚Ä¶ Tx: "+tx.hash);

    const receipt = await tx.wait();
    log("Mint confirmed!\nTx: "+receipt.hash);

  }catch(err){
    log("Mint error:\n"+(err.reason||err.message||err));
  }
};
</script>

</body>
</html>
